<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat Himalaya: The Horror Maze</title>
    <style>
        :root { --gold: #FFD700; --blood: #8a0303; }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Cairo', sans-serif; touch-action: none; color: white; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
        #stage-screen { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .window { 
            background: linear-gradient(180deg, #1a0000, #000); padding: 40px; 
            border-radius: 30px; border: 2px solid var(--blood); text-align: center;
            box-shadow: 0 0 50px var(--blood);
        }
        .next-btn { 
            background: var(--blood); color: white; padding: 15px 50px; border: none; 
            border-radius: 50px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 500; font-weight: bold; color: var(--gold); }
        canvas { display: block; }
    </style>
</head>
<body>

<div id="hud">
    <div>ğŸ’° Ø§Ù„Ø¹Ù…Ù„Ø§Øª: <span id="coin-val">0</span></div>
    <div>ğŸ¦‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <span id="stage-val">1</span></div>
    <div>ğŸ“ Ø§Ù„Ø¹Ù…Ù‚: <span id="dist-val">0</span></div>
</div>

<div id="stage-screen">
    <div class="window">
        <h1 id="msg-title" style="color:var(--blood);">Ù…Ø¯Ø®Ù„ Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² Ø§Ù„Ù…Ø±Ø¹Ø¨</h1>
        <p id="msg-desc">Ø§Ù„Ù‚Ø·Ø© Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§ Ø¹Ø§Ù„Ù‚Ø© ÙÙŠ Ø§Ù„ÙƒÙ‡Ù.. Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹ Ø¥Ù†Ù‚Ø§Ø°Ù‡Ø§ØŸ</p>
        <button class="next-btn" id="actionBtn" onclick="nextStage()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1</button>
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
const screen = document.getElementById('stage-screen'), actionBtn = document.getElementById('actionBtn');

// ØµÙˆØ± Ø­Ù‚ÙŠÙ‚ÙŠØ©
const catImg = new Image(); catImg.src = 'https://cdn-icons-png.flaticon.com/512/1864/1864514.png'; // ØµÙˆØ±Ø© Ù‚Ø·Ø© ÙˆØ§Ù‚Ø¹ÙŠØ© (Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©)
const monsterImg = new Image(); monsterImg.src = 'https://cdn-icons-png.flaticon.com/512/1211/1211053.png'; // ÙˆØ­Ø´ Ù…Ø±Ø¹Ø¨
const coinImg = new Image(); coinImg.src = 'https://cdn-icons-png.flaticon.com/512/2489/2489756.png'; // Ø¹Ù…Ù„Ø© Ø°Ù‡Ø¨ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©

let active = false, stage = 1, coins = 0, distance = 0, frame = 0;
let obstacles = [], goldList = [], stars = [];
let p = { x: 150, y: 0, v: 0, g: 0.4, j: -8, w: 60, h: 50 };

// Ø£ØµÙˆØ§Øª Ù…Ø®ÙŠÙØ© (Ø¨Ø³ÙŠØ·Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playHorrorSound(f, d) {
    let o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = 'sawtooth'; o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d);
}

function initStars() {
    stars = [];
    for(let i=0; i<100; i++) stars.push({x: Math.random()*innerWidth, y: Math.random()*innerHeight, s: Math.random()*2});
}
window.onresize = () => { canvas.width = innerWidth; canvas.height = innerHeight; initStars(); };
window.onresize();

function nextStage() {
    if(audioCtx.state === 'suspended') audioCtx.resume();
    screen.style.display = 'none';
    active = true; distance = 0; obstacles = []; goldList = []; frame = 0;
    p.y = canvas.height / 2; p.v = 0;
    playHorrorSound(100, 1); // ØµÙˆØª Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒÙ‡Ù
    loop();
}

function loop() {
    if(!active) return;
    frame++; distance++;
    document.getElementById('dist-val').innerText = distance;

    // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù…Ø±Ø¹Ø¨Ø©)
    ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.fillStyle = "#fff";
    stars.forEach(s => { s.x -= 0.5; if(s.x < 0) s.x = canvas.width; ctx.fillRect(s.x, s.y, s.s, s.s); });

    // Ø±Ø³Ù… Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² (Ø¬Ø¯Ø±Ø§Ù† Ø¹Ù„ÙˆÙŠØ© ÙˆØ³ÙÙ„ÙŠØ© Ø¨Ø£Ù„ÙˆØ§Ù† Ù…ØªØºÙŠØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©)
    let hue = (stage * 40) % 360;
    ctx.fillStyle = `hsla(${hue}, 100%, 10%, 0.8)`;
    let wallH = 100 + Math.sin(frame*0.02) * 50;
    ctx.fillRect(0, 0, canvas.width, wallH); // Ø¬Ø¯Ø§Ø± Ø¹Ù„ÙˆÙŠ
    ctx.fillRect(0, canvas.height - wallH, canvas.width, wallH); // Ø¬Ø¯Ø§Ø± Ø³ÙÙ„ÙŠ

    // Ø§Ù„Ù‚Ø·Ø© Ù‡ÙŠÙ…Ø§Ù„Ø§ÙŠØ§
    p.v += p.g; p.y += p.v;
    ctx.drawImage(catImg, p.x, p.y, p.w, p.h);

    // Ø§Ù„ÙƒÙˆÙŠÙ†Ø² Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    if(frame % 70 == 0) goldList.push({x: canvas.width, y: 150 + Math.random()*(canvas.height-300)});
    goldList.forEach((g, i) => {
        g.x -= 5;
        ctx.drawImage(coinImg, g.x, g.y, 30, 30);
        if(Math.hypot(p.x+20-g.x, p.y+20-g.y) < 35) { 
            goldList.splice(i,1); coins++; 
            document.getElementById('coin-val').innerText = coins;
            playHorrorSound(800, 0.1);
        }
    });

    // Ø§Ù„ÙˆØ­ÙˆØ´ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    if(frame % Math.max(30, 100 - stage*5) == 0 && distance < 1500) {
        obstacles.push({x: canvas.width, y: wallH + Math.random()*(canvas.height-wallH*2-50), s: 60});
    }
    obstacles.forEach((o, i) => {
        o.x -= (6 + stage);
        ctx.drawImage(monsterImg, o.x, o.y, o.s, o.s);
        if(Math.hypot(p.x+25-o.x, p.y+25-o.y) < 40) die();
        if(o.x < -100) obstacles.splice(i, 1);
    });

    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© (Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ‡Ù)
    if(distance > 2000) {
        active = false;
        stage++;
        if(stage > 20) {
            alert("Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø£Ù†Ù‚Ø°Øª Ø§Ù„Ù‚Ø·Ø© ÙˆØªØ²ÙˆØ¬Øª ÙÙŠ Ø§Ù„Ù€ 55! ğŸ‰ğŸ’");
            location.reload();
        } else {
            document.getElementById('msg-title').innerText = "ØªÙ… Ø§Ø¬ØªÙŠØ§Ø² Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² " + (stage-1);
            document.getElementById('msg-desc').innerText = "Ø§Ø³ØªØ¹Ø¯ØŒ Ø§Ù„Ø¯Ù‡Ù„ÙŠØ² Ø§Ù„Ù‚Ø§Ø¯Ù… Ø£ÙƒØ«Ø± Ø±Ø¹Ø¨Ø§Ù‹ ÙˆØ¸Ù„Ù…Ø©..";
            document.getElementById('stage-val').innerText = stage;
            actionBtn.innerText = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø±Ø­Ù„Ø© " + stage;
            screen.style.display = 'flex';
        }
    }

    if(p.y > canvas.height - wallH || p.y < wallH) die();
    requestAnimationFrame(loop);
}

function die() {
    active = false;
    playHorrorSound(50, 0.8);
    document.getElementById('msg-title').innerText = "Ù„Ù‚Ø¯ Ù‚ØªÙ„Ùƒ Ø§Ù„ÙˆØ­Ø´!";
    document.getElementById('msg-desc').innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ù‚Ø·Ø©.";
    actionBtn.innerText = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";
    screen.style.display = 'flex';
}

// Ø§Ù„ØªØ­ÙƒÙ…
const jump = () => { if(active) p.v = p.j; };
window.onmousedown = jump;
window.ontouchstart = (e) => { jump(); e.preventDefault(); };

</script>
</body>
</html>